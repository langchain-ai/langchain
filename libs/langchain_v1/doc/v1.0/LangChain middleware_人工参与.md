# LangChain ä¸­é—´ä»¶ï¼šäººå·¥å‚ä¸ï¼ˆHuman-in-the-Loopï¼‰

æš‚åœæ™ºèƒ½ä½“æ‰§è¡Œï¼Œä»¥ä¾¿åœ¨å·¥å…·è°ƒç”¨æ‰§è¡Œå‰è·å¾—äººå·¥æ‰¹å‡†ã€ç¼–è¾‘æˆ–æ‹’ç»ã€‚

## é€‚ç”¨åœºæ™¯

- éœ€è¦äººå·¥æ‰¹å‡†çš„**é«˜é£é™©æ“ä½œ**ï¼ˆä¾‹å¦‚æ•°æ®åº“å†™å…¥ã€é‡‘èäº¤æ˜“ï¼‰
- éœ€è¦å¼ºåˆ¶äººå·¥ç›‘ç£çš„**åˆè§„å·¥ä½œæµç¨‹**
- éœ€è¦äººå·¥åé¦ˆå¼•å¯¼æ™ºèƒ½ä½“çš„**é•¿æ—¶é—´è¿è¡Œå¯¹è¯**

> **æ³¨æ„**ï¼šäººå·¥å‚ä¸ä¸­é—´ä»¶éœ€è¦ä¸€ä¸ª `checkpointer` æ¥åœ¨ä¸­æ–­æ—¶ä¿æŒçŠ¶æ€ã€‚

---

## åŸºç¡€ç”¨æ³•

```python
from langchain.agents import create_agent
from langchain.agents.middleware import HumanInTheLoopMiddleware
from langgraph.checkpoint.memory import InMemorySaver

# ============================================================================
# Step 1: å®šä¹‰å·¥å…·å‡½æ•°
# ============================================================================
# è¿™äº›æ˜¯ Agent å¯ä»¥è°ƒç”¨çš„å·¥å…·ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™äº›å¯èƒ½æ˜¯ï¼š
# - æ•°æ®åº“æ“ä½œï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
# - å‘é€é€šçŸ¥ï¼ˆé‚®ä»¶ã€çŸ­ä¿¡ã€Slackï¼‰
# - æ‰§è¡Œäº¤æ˜“ï¼ˆæ”¯ä»˜ã€è½¬è´¦ï¼‰
# - è°ƒç”¨å¤–éƒ¨ API ç­‰

def read_email_tool(email_id: str) -> str:
    """è¯»å–é‚®ä»¶ - ä½é£é™©æ“ä½œï¼Œä¸éœ€è¦äººå·¥å®¡æ‰¹"""
    return f"Email content for ID: {email_id}"


def send_email_tool(recipient: str, subject: str, body: str) -> str:
    """å‘é€é‚®ä»¶ - é«˜é£é™©æ“ä½œï¼Œéœ€è¦äººå·¥å®¡æ‰¹åæ‰èƒ½æ‰§è¡Œ"""
    return f"Email sent to {recipient} with subject '{subject}'"


# ============================================================================
# Step 2: åˆ›å»ºå¸¦æœ‰äººå·¥å‚ä¸ä¸­é—´ä»¶çš„ Agent
# ============================================================================
agent = create_agent(
    model="gpt-4o",
    tools=[read_email_tool, send_email_tool],
    
    # --------------------------------------------------------------------
    # checkpointer: çŠ¶æ€æŒä¹…åŒ–å™¨ï¼ˆå¿…é¡»é…ç½®ï¼ï¼‰
    # --------------------------------------------------------------------
    # ä½œç”¨ï¼šåœ¨ä¸­æ–­æ—¶ä¿å­˜å®Œæ•´çš„ Agent çŠ¶æ€ï¼ˆåŒ…æ‹¬æ¶ˆæ¯å†å²ã€å¾…æ‰§è¡Œçš„å·¥å…·è°ƒç”¨ç­‰ï¼‰
    # åŸç†ï¼šå½“è§¦å‘äººå·¥å®¡æ‰¹æ—¶ï¼ŒAgent ä¼šæš‚åœæ‰§è¡Œï¼Œæ­¤æ—¶éœ€è¦ä¿å­˜çŠ¶æ€
    #       ç­‰äººå·¥åšå‡ºå†³ç­–åï¼Œä»ä¿å­˜çš„çŠ¶æ€æ¢å¤ç»§ç»­æ‰§è¡Œ
    # é€‰é¡¹ï¼š
    #   - InMemorySaver(): å†…å­˜å­˜å‚¨ï¼Œé€‚åˆå¼€å‘æµ‹è¯•
    #   - SqliteSaver(): SQLite å­˜å‚¨ï¼Œé€‚åˆå•æœºç”Ÿäº§ç¯å¢ƒ
    #   - PostgresSaver(): PostgreSQL å­˜å‚¨ï¼Œé€‚åˆåˆ†å¸ƒå¼ç”Ÿäº§ç¯å¢ƒ
    checkpointer=InMemorySaver(),
    
    middleware=[
        # ----------------------------------------------------------------
        # HumanInTheLoopMiddleware: äººå·¥å‚ä¸ä¸­é—´ä»¶
        # ----------------------------------------------------------------
        # ä½œç”¨ï¼šåœ¨æŒ‡å®šå·¥å…·æ‰§è¡Œå‰æš‚åœï¼Œç­‰å¾…äººå·¥å®¡æ‰¹
        # æ—¶æœºï¼šafter_model é’©å­ï¼ˆæ¨¡å‹è¿”å› tool_calls åï¼Œtools èŠ‚ç‚¹æ‰§è¡Œå‰ï¼‰
        HumanInTheLoopMiddleware(
            # ------------------------------------------------------------
            # interrupt_on: é…ç½®å“ªäº›å·¥å…·éœ€è¦äººå·¥å‚ä¸
            # ------------------------------------------------------------
            # key: å·¥å…·å‡½æ•°åï¼ˆå­—ç¬¦ä¸²ï¼‰
            # value: 
            #   - False: ä¸éœ€è¦å®¡æ‰¹ï¼Œç›´æ¥æ‰§è¡Œ
            #   - True: éœ€è¦å®¡æ‰¹ï¼Œä½¿ç”¨é»˜è®¤å†³ç­–é€‰é¡¹
            #   - dict: è‡ªå®šä¹‰é…ç½®ï¼ˆå¦‚ allowed_decisionsï¼‰
            interrupt_on={
                # å‘é€é‚®ä»¶ï¼šé«˜é£é™©æ“ä½œï¼Œéœ€è¦äººå·¥å®¡æ‰¹
                # äººå·¥å¯ä»¥é€‰æ‹©ï¼š
                #   - "approve": æ‰¹å‡†å‘é€
                #   - "edit": ä¿®æ”¹æ”¶ä»¶äºº/ä¸»é¢˜/å†…å®¹åå‘é€
                #   - "reject": æ‹’ç»å‘é€
                "send_email_tool": {
                    "allowed_decisions": ["approve", "edit", "reject"],
                },
                
                # è¯»å–é‚®ä»¶ï¼šä½é£é™©æ“ä½œï¼Œä¸éœ€è¦å®¡æ‰¹
                # Agent å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œä¸ä¼šè¢«ä¸­æ–­
                "read_email_tool": False,
            }
        ),
    ],
)

# ============================================================================
# æ‰§è¡Œæµç¨‹è¯´æ˜ï¼š
# ============================================================================
# 1. ç”¨æˆ·è¾“å…¥: "å‘é€é‚®ä»¶ç»™ boss@company.comï¼Œä¸»é¢˜æ˜¯'å‘¨æŠ¥'"
# 2. model èŠ‚ç‚¹: LLM åˆ†æåå†³å®šè°ƒç”¨ send_email_tool
# 3. HumanInTheLoopMiddleware æ£€æµ‹åˆ° send_email_tool éœ€è¦å®¡æ‰¹
# 4. Agent æš‚åœæ‰§è¡Œï¼ŒçŠ¶æ€ä¿å­˜åˆ° checkpointer
# 5. è¿”å›ä¸­æ–­ä¿¡æ¯ç»™è°ƒç”¨æ–¹ï¼Œç­‰å¾…äººå·¥å†³ç­–
# 6. äººå·¥å®¡æ‰¹åï¼ˆapprove/edit/rejectï¼‰ï¼Œå†æ¬¡è°ƒç”¨ agent.invoke()
# 7. ä» checkpointer æ¢å¤çŠ¶æ€ï¼Œæ ¹æ®å†³ç­–ç»§ç»­æ‰§è¡Œæˆ–ç»“æŸ
```

---

## é…ç½®é€‰é¡¹

### `interrupt_on`

é…ç½®å“ªäº›å·¥å…·éœ€è¦äººå·¥å‚ä¸ï¼Œä»¥åŠå…è®¸çš„å†³ç­–ç±»å‹ã€‚

| é…ç½®æ–¹å¼ | è¯´æ˜ |
|----------|------|
| `"tool_name": True` | å·¥å…·éœ€è¦äººå·¥å®¡æ‰¹ï¼Œä½¿ç”¨é»˜è®¤å†³ç­–é€‰é¡¹ |
| `"tool_name": False` | å·¥å…·ä¸éœ€è¦äººå·¥å®¡æ‰¹ |
| `"tool_name": {"allowed_decisions": [...]}` | æŒ‡å®šå…è®¸çš„å†³ç­–ç±»å‹ |

### `allowed_decisions`

| å†³ç­–ç±»å‹ | è¯´æ˜ |
|----------|------|
| `"approve"` | æ‰¹å‡†æ‰§è¡Œå·¥å…·è°ƒç”¨ |
| `"edit"` | ç¼–è¾‘å·¥å…·è°ƒç”¨å‚æ•°åæ‰§è¡Œ |
| `"reject"` | æ‹’ç»æ‰§è¡Œå·¥å…·è°ƒç”¨ |

---

## æ‰§è¡Œæµç¨‹

```
ç”¨æˆ·å‘é€æ¶ˆæ¯
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ model èŠ‚ç‚¹ï¼ˆLLM å†³å®šè°ƒç”¨å·¥å…·ï¼‰        â”‚
â”‚                                      â”‚
â”‚ è¿”å›: tool_calls = [send_email_tool] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HumanInTheLoopMiddleware æ£€æŸ¥        â”‚
â”‚                                      â”‚
â”‚ send_email_tool åœ¨ interrupt_on ä¸­   â”‚
â”‚ â†’ è§¦å‘ä¸­æ–­ï¼Œä¿å­˜çŠ¶æ€åˆ° checkpointer  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç­‰å¾…äººå·¥å†³ç­–                          â”‚
â”‚                                      â”‚
â”‚ - approve: ç»§ç»­æ‰§è¡Œå·¥å…·              â”‚
â”‚ - edit: ä¿®æ”¹å‚æ•°åæ‰§è¡Œ               â”‚
â”‚ - reject: å–æ¶ˆæ‰§è¡Œï¼Œè¿”å›æ‹’ç»æ¶ˆæ¯     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ ¹æ®å†³ç­–ç»§ç»­æ‰§è¡Œæˆ–ç»“æŸ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä½¿ç”¨ç¤ºä¾‹

### æ‰§è¡Œ Agent å¹¶å¤„ç†ä¸­æ–­

```python
from langchain_core.messages import HumanMessage

# ç¬¬ä¸€æ¬¡è°ƒç”¨ - å¯èƒ½ä¼šä¸­æ–­ç­‰å¾…å®¡æ‰¹
config = {"configurable": {"thread_id": "user-123"}}
result = agent.invoke(
    {"messages": [HumanMessage("å‘é€é‚®ä»¶ç»™ boss@company.comï¼Œä¸»é¢˜æ˜¯'å‘¨æŠ¥'")]},
    config=config,
)

# æ£€æŸ¥æ˜¯å¦è¢«ä¸­æ–­
if result.get("__interrupt__"):
    print("ç­‰å¾…äººå·¥å®¡æ‰¹...")
    pending_tool_call = result["__interrupt__"]["tool_call"]
    print(f"å·¥å…·: {pending_tool_call['name']}")
    print(f"å‚æ•°: {pending_tool_call['args']}")
```

### æäº¤äººå·¥å†³ç­–

```python
# æ‰¹å‡†æ‰§è¡Œ
agent.invoke(
    {"decision": "approve"},
    config=config,
)

# æˆ–è€…ç¼–è¾‘å‚æ•°åæ‰§è¡Œ
agent.invoke(
    {
        "decision": "edit",
        "edited_args": {
            "recipient": "boss@company.com",
            "subject": "å‘¨æŠ¥ - ä¿®æ”¹ç‰ˆ",
            "body": "ä¿®æ”¹åçš„å†…å®¹...",
        },
    },
    config=config,
)

# æˆ–è€…æ‹’ç»æ‰§è¡Œ
agent.invoke(
    {"decision": "reject", "reason": "é‚®ä»¶å†…å®¹éœ€è¦ä¿®æ”¹"},
    config=config,
)
```

---

## å…³é”®è®¾è®¡

| ç»„ä»¶ | è¯´æ˜ |
|------|------|
| `checkpointer` | **å¿…é¡»é…ç½®**ï¼Œç”¨äºä¿å­˜ä¸­æ–­æ—¶çš„çŠ¶æ€ |
| `interrupt_on` | é…ç½®å“ªäº›å·¥å…·éœ€è¦äººå·¥å‚ä¸ |
| `allowed_decisions` | å®šä¹‰äººå·¥å¯ä»¥åšå‡ºçš„å†³ç­–ç±»å‹ |
| `thread_id` | æ ‡è¯†å¯¹è¯çº¿ç¨‹ï¼Œç”¨äºæ¢å¤ä¸­æ–­çš„æ‰§è¡Œ |

## HumanInTheLoopMiddleware æµç¨‹

### ä¸€ã€ä¸­é—´ä»¶æ¦‚è¿°

`HumanInTheLoopMiddleware` æ˜¯ä¸€ä¸ª**äººå·¥å‚ä¸ä¸­é—´ä»¶**ï¼Œé€šè¿‡ `after_model` é’©å­å®ç°ã€‚å®ƒåœ¨æ¨¡å‹è¿”å›å·¥å…·è°ƒç”¨åæš‚åœæ‰§è¡Œï¼Œç­‰å¾…äººå·¥å®¡æ‰¹ã€ç¼–è¾‘æˆ–æ‹’ç»ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚   æ ¸å¿ƒåŠŸèƒ½ï¼š                                                             â”‚
â”‚                                                                         â”‚
â”‚   1. åœ¨æ¨¡å‹è¿”å› tool_calls åæ£€æŸ¥æ˜¯å¦éœ€è¦äººå·¥å®¡æ‰¹                        â”‚
â”‚   2. å¦‚æœéœ€è¦ï¼Œè°ƒç”¨ interrupt() æš‚åœæ‰§è¡Œï¼Œç­‰å¾…äººå·¥å†³ç­–                   â”‚
â”‚   3. äººå·¥å¯åšå‡ºä¸‰ç§å†³ç­–ï¼š                                                â”‚
â”‚      - approveï¼šæ‰¹å‡†æ‰§è¡Œï¼Œä¿æŒåŸæ ·                                       â”‚
â”‚      - editï¼šä¿®æ”¹å·¥å…·åç§°æˆ–å‚æ•°åæ‰§è¡Œ                                    â”‚
â”‚      - rejectï¼šæ‹’ç»æ‰§è¡Œï¼Œæ³¨å…¥é”™è¯¯ ToolMessage                            â”‚
â”‚   4. æ ¹æ®å†³ç­–ä¿®æ”¹ AIMessage.tool_callsï¼Œç»§ç»­æ‰§è¡Œ                         â”‚
â”‚                                                                         â”‚
â”‚   å‰ç½®æ¡ä»¶ï¼š                                                             â”‚
â”‚   - å¿…é¡»é…ç½® checkpointerï¼ˆç”¨äºä¿å­˜ä¸­æ–­æ—¶çš„çŠ¶æ€ï¼‰                        â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### äºŒã€æ ¸å¿ƒæ•°æ®ç»“æ„

#### é…ç½®ç›¸å…³

```python
# å·¥å…·é…ç½®
InterruptOnConfig = TypedDict(
    allowed_decisions: list["approve" | "edit" | "reject"],  # å…è®¸çš„å†³ç­–ç±»å‹
    description: str | Callable | None,  # æè¿°ï¼ˆé™æ€æˆ–åŠ¨æ€ç”Ÿæˆï¼‰
    args_schema: dict | None,  # å‚æ•°çš„ JSON Schemaï¼ˆç”¨äº editï¼‰
)

# ä¸­æ–­è¯·æ±‚ï¼ˆå‘é€ç»™äººå·¥å®¡æ‰¹ç³»ç»Ÿï¼‰
HITLRequest = TypedDict(
    action_requests: list[ActionRequest],  # å¾…å®¡æ‰¹çš„åŠ¨ä½œåˆ—è¡¨
    review_configs: list[ReviewConfig],    # æ¯ä¸ªåŠ¨ä½œçš„å®¡æ‰¹é…ç½®
)

ActionRequest = TypedDict(
    name: str,           # å·¥å…·åç§°
    args: dict,          # å·¥å…·å‚æ•°
    description: str,    # æè¿°ä¿¡æ¯
)

ReviewConfig = TypedDict(
    action_name: str,                    # å·¥å…·åç§°
    allowed_decisions: list[str],        # å…è®¸çš„å†³ç­–
    args_schema: dict | None,            # å‚æ•° Schema
)
```

#### å†³ç­–ç›¸å…³

```python
# äººå·¥å†³ç­–ç±»å‹
ApproveDecision = TypedDict(type: Literal["approve"])

EditDecision = TypedDict(
    type: Literal["edit"],
    edited_action: Action,  # ä¿®æ”¹åçš„åŠ¨ä½œ {name, args}
)

RejectDecision = TypedDict(
    type: Literal["reject"],
    message: str | None,  # æ‹’ç»åŸå› 
)

# äººå·¥å“åº”
HITLResponse = TypedDict(
    decisions: list[Decision],  # å†³ç­–åˆ—è¡¨ï¼Œä¸ action_requests ä¸€ä¸€å¯¹åº”
)
```

---

### ä¸‰ã€è¾“å…¥è¾“å‡ºå®šä¹‰

#### é…ç½®å‚æ•°

```python
HumanInTheLoopMiddleware(
    interrupt_on: dict[str, bool | InterruptOnConfig],
    description_prefix: str = "Tool execution requires approval",
)
```

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `interrupt_on` | `dict` | é…ç½®å“ªäº›å·¥å…·éœ€è¦äººå·¥å®¡æ‰¹ |
| `description_prefix` | `str` | é»˜è®¤æè¿°å‰ç¼€ |

#### interrupt_on é…ç½®æ–¹å¼

| å€¼ | è¯´æ˜ |
|------|------|
| `"tool_name": True` | éœ€è¦å®¡æ‰¹ï¼Œå…è®¸æ‰€æœ‰å†³ç­–ï¼ˆapprove/edit/rejectï¼‰ |
| `"tool_name": False` | ä¸éœ€è¦å®¡æ‰¹ï¼Œè‡ªåŠ¨æ‰¹å‡† |
| `"tool_name": InterruptOnConfig(...)` | è‡ªå®šä¹‰é…ç½® |
| å·¥å…·ä¸åœ¨é…ç½®ä¸­ | ä¸éœ€è¦å®¡æ‰¹ï¼Œè‡ªåŠ¨æ‰¹å‡† |

#### after_model è¾“å…¥è¾“å‡º

| è¾“å…¥ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `state["messages"]` | `list[AnyMessage]` | å½“å‰æ¶ˆæ¯åˆ—è¡¨ï¼ˆåŒ…å«æœ€æ–° AIMessageï¼‰ |
| `runtime` | `Runtime` | LangGraph è¿è¡Œæ—¶ |

| è¾“å‡º | æ¡ä»¶ | ç±»å‹ | è¯´æ˜ |
|------|------|------|------|
| `None` | æ—  tool_calls æˆ–æ— éœ€å®¡æ‰¹ | `None` | ä¸ä¿®æ”¹çŠ¶æ€ |
| `{"messages": [AIMessage, *ToolMessages]}` | æœ‰å®¡æ‰¹å·¥å…· | `dict` | ä¿®æ”¹åçš„ AIMessage + æ‹’ç»çš„ ToolMessages |
| `interrupt(HITLRequest)` | è§¦å‘ä¸­æ–­ | æš‚åœ | ç­‰å¾…äººå·¥å†³ç­– |

---

### å››ã€å®Œæ•´æµç¨‹å›¾

```
ç”¨æˆ·å‘é€æ¶ˆæ¯
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      model èŠ‚ç‚¹ï¼ˆè°ƒç”¨ LLMï¼‰                       â”‚
â”‚                                                                  â”‚
â”‚   è¿”å› AIMessage:                                                â”‚
â”‚   tool_calls = [                                                 â”‚
â”‚       {id: "call_1", name: "send_email", args: {...}},           â”‚
â”‚       {id: "call_2", name: "read_file", args: {...}},            â”‚
â”‚   ]                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                      â”‚
â”‚                       after_model(state, runtime)                                    â”‚
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Step 1: è·å–æœ€åä¸€ä¸ª AIMessage                                                 â”‚  â”‚
â”‚  â”‚                                                                                â”‚  â”‚
â”‚  â”‚   last_ai_msg = next(msg for msg in reversed(messages)                         â”‚  â”‚
â”‚  â”‚                      if isinstance(msg, AIMessage))                            â”‚  â”‚
â”‚  â”‚                                                                                â”‚  â”‚
â”‚  â”‚   if not last_ai_msg or not last_ai_msg.tool_calls:                            â”‚  â”‚
â”‚  â”‚       return None  # æ— å·¥å…·è°ƒç”¨ï¼Œè·³è¿‡                                          â”‚  â”‚
â”‚  â”‚                                                                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                           â”‚                                          â”‚
â”‚                                           â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Step 2: éå† tool_callsï¼Œæ‰¾å‡ºéœ€è¦å®¡æ‰¹çš„å·¥å…·                                    â”‚  â”‚
â”‚  â”‚                                                                                â”‚  â”‚
â”‚  â”‚   action_requests = []   # å¾…å®¡æ‰¹çš„åŠ¨ä½œ                                        â”‚  â”‚
â”‚  â”‚   review_configs = []    # å®¡æ‰¹é…ç½®                                            â”‚  â”‚
â”‚  â”‚   interrupt_indices = [] # éœ€è¦å®¡æ‰¹çš„å·¥å…·ç´¢å¼•                                  â”‚  â”‚
â”‚  â”‚                                                                                â”‚  â”‚
â”‚  â”‚   for idx, tool_call in enumerate(last_ai_msg.tool_calls):                     â”‚  â”‚
â”‚  â”‚       config = self.interrupt_on.get(tool_call["name"])                        â”‚  â”‚
â”‚  â”‚       if config is not None:  # åœ¨é…ç½®ä¸­ä¸”ä¸æ˜¯ False                           â”‚  â”‚
â”‚  â”‚           action_request, review_config = _create_action_and_config(...)       â”‚  â”‚
â”‚  â”‚           action_requests.append(action_request)                               â”‚  â”‚
â”‚  â”‚           review_configs.append(review_config)                                 â”‚  â”‚
â”‚  â”‚           interrupt_indices.append(idx)                                        â”‚  â”‚
â”‚  â”‚                                                                                â”‚  â”‚
â”‚  â”‚   if not action_requests:                                                      â”‚  â”‚
â”‚  â”‚       return None  # æ— éœ€å®¡æ‰¹çš„å·¥å…·                                            â”‚  â”‚
â”‚  â”‚                                                                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                           â”‚                                          â”‚
â”‚                                           â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Step 3: æ„å»º HITLRequest å¹¶è§¦å‘ä¸­æ–­                                            â”‚  â”‚
â”‚  â”‚                                                                                â”‚  â”‚
â”‚  â”‚   hitl_request = HITLRequest(                                                  â”‚  â”‚
â”‚  â”‚       action_requests=action_requests,                                         â”‚  â”‚
â”‚  â”‚       review_configs=review_configs,                                           â”‚  â”‚
â”‚  â”‚   )                                                                            â”‚  â”‚
â”‚  â”‚                                                                                â”‚  â”‚
â”‚  â”‚   # ğŸ”´ å…³é”®ï¼šè°ƒç”¨ interrupt() æš‚åœæ‰§è¡Œ                                         â”‚  â”‚
â”‚  â”‚   # çŠ¶æ€è¢«ä¿å­˜åˆ° checkpointerï¼Œç­‰å¾…äººå·¥å†³ç­–                                    â”‚  â”‚
â”‚  â”‚   decisions = interrupt(hitl_request)["decisions"]                             â”‚  â”‚
â”‚  â”‚                                                                                â”‚  â”‚
â”‚  â”‚   # interrupt() è¿”å›åï¼Œè¡¨ç¤ºäººå·¥å·²åšå‡ºå†³ç­–                                     â”‚  â”‚
â”‚  â”‚                                                                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                           â”‚                                          â”‚
â”‚                              â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•                             â”‚
â”‚                              â•‘  äººå·¥å®¡æ‰¹  â•‘                                          â”‚
â”‚                              â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•                             â”‚
â”‚                                           â”‚                                          â”‚
â”‚                                           â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Step 4: å¤„ç†äººå·¥å†³ç­–                                                           â”‚  â”‚
â”‚  â”‚                                                                                â”‚  â”‚
â”‚  â”‚   revised_tool_calls = []                                                      â”‚  â”‚
â”‚  â”‚   artificial_tool_messages = []                                                â”‚  â”‚
â”‚  â”‚                                                                                â”‚  â”‚
â”‚  â”‚   for idx, tool_call in enumerate(last_ai_msg.tool_calls):                     â”‚  â”‚
â”‚  â”‚       if idx in interrupt_indices:                                             â”‚  â”‚
â”‚  â”‚           # éœ€è¦å®¡æ‰¹çš„å·¥å…· â†’ å¤„ç†å†³ç­–                                          â”‚  â”‚
â”‚  â”‚           decision = decisions[decision_idx]                                   â”‚  â”‚
â”‚  â”‚           revised_call, tool_msg = _process_decision(decision, tool_call, ...) â”‚  â”‚
â”‚  â”‚                                                                                â”‚  â”‚
â”‚  â”‚           if revised_call:                                                     â”‚  â”‚
â”‚  â”‚               revised_tool_calls.append(revised_call)                          â”‚  â”‚
â”‚  â”‚           if tool_msg:                                                         â”‚  â”‚
â”‚  â”‚               artificial_tool_messages.append(tool_msg)                        â”‚  â”‚
â”‚  â”‚       else:                                                                    â”‚  â”‚
â”‚  â”‚           # ä¸éœ€è¦å®¡æ‰¹ â†’ ä¿æŒåŸæ ·                                              â”‚  â”‚
â”‚  â”‚           revised_tool_calls.append(tool_call)                                 â”‚  â”‚
â”‚  â”‚                                                                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                           â”‚                                          â”‚
â”‚                                           â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Step 5: æ›´æ–° AIMessage å¹¶è¿”å›                                                  â”‚  â”‚
â”‚  â”‚                                                                                â”‚  â”‚
â”‚  â”‚   # ä¿®æ”¹åŸ AIMessage çš„ tool_calls                                             â”‚  â”‚
â”‚  â”‚   last_ai_msg.tool_calls = revised_tool_calls                                  â”‚  â”‚
â”‚  â”‚                                                                                â”‚  â”‚
â”‚  â”‚   # è¿”å›ä¿®æ”¹åçš„ AIMessage + æ‹’ç»äº§ç”Ÿçš„ ToolMessages                           â”‚  â”‚
â”‚  â”‚   return {"messages": [last_ai_msg, *artificial_tool_messages]}                â”‚  â”‚
â”‚  â”‚                                                                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚     tools èŠ‚ç‚¹æ‰§è¡Œ          â”‚
                              â”‚                             â”‚
                              â”‚  åªæ‰§è¡Œ revised_tool_calls  â”‚
                              â”‚  è¢«æ‹’ç»çš„å·²æœ‰ ToolMessage   â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### äº”ã€_process_decision å†³ç­–å¤„ç†è¯¦è§£

```
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   _process_decision()       â”‚
                              â”‚                             â”‚
                              â”‚   è¾“å…¥:                     â”‚
                              â”‚   - decision: äººå·¥å†³ç­–      â”‚
                              â”‚   - tool_call: åŸå·¥å…·è°ƒç”¨   â”‚
                              â”‚   - config: å·¥å…·é…ç½®        â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                            â”‚                            â”‚
              â–¼                            â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ decision.type="approve" â”‚  â”‚ decision.type="edit"    â”‚  â”‚ decision.type="reject"  â”‚
â”‚                         â”‚  â”‚                         â”‚  â”‚                         â”‚
â”‚ äººå·¥æ‰¹å‡†æ‰§è¡Œ            â”‚  â”‚ äººå·¥ä¿®æ”¹åæ‰§è¡Œ          â”‚  â”‚ äººå·¥æ‹’ç»æ‰§è¡Œ            â”‚
â”‚                         â”‚  â”‚                         â”‚  â”‚                         â”‚
â”‚ è¿”å›:                   â”‚  â”‚ edited_action =         â”‚  â”‚ è¿”å›:                   â”‚
â”‚ (tool_call, None)       â”‚  â”‚   decision["edited_     â”‚  â”‚ (tool_call,             â”‚
â”‚                         â”‚  â”‚     action"]            â”‚  â”‚  ToolMessage(           â”‚
â”‚ tool_call ä¿æŒåŸæ ·      â”‚  â”‚                         â”‚  â”‚    content=æ‹’ç»åŸå› ,    â”‚
â”‚ æ—  ToolMessage          â”‚  â”‚ è¿”å›:                   â”‚  â”‚    status="error",      â”‚
â”‚                         â”‚  â”‚ (ToolCall(              â”‚  â”‚    tool_call_id=...,    â”‚
â”‚                         â”‚  â”‚   name=edited_name,     â”‚  â”‚  ))                     â”‚
â”‚                         â”‚  â”‚   args=edited_args,     â”‚  â”‚                         â”‚
â”‚                         â”‚  â”‚   id=åŸid               â”‚  â”‚ å·¥å…·ä¸ä¼šæ‰§è¡Œ            â”‚
â”‚                         â”‚  â”‚ ), None)                â”‚  â”‚ ToolMessage ä½œä¸ºç»“æœ    â”‚
â”‚                         â”‚  â”‚                         â”‚  â”‚                         â”‚
â”‚                         â”‚  â”‚ ç”¨ä¿®æ”¹åçš„å‚æ•°æ‰§è¡Œ      â”‚  â”‚                         â”‚
â”‚                         â”‚  â”‚ æ—  ToolMessage          â”‚  â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### å…­ã€ä¸‰ç§å†³ç­–åœºæ™¯å¯¹æ¯”

#### åœºæ™¯ï¼šAI è°ƒç”¨ send_email(recipient="boss@co.com", subject="å‘¨æŠ¥", body="...")

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Approveï¼ˆæ‰¹å‡†ï¼‰                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚   äººå·¥å†³ç­–: {"type": "approve"}                                                     â”‚
â”‚                                                                                     â”‚
â”‚   å¤„ç†ç»“æœ:                                                                         â”‚
â”‚   - revised_tool_calls = [send_email(recipient="boss@co.com", ...)]  # ä¿æŒåŸæ ·    â”‚
â”‚   - artificial_tool_messages = []  # æ—                                             â”‚
â”‚                                                                                     â”‚
â”‚   åç»­: tools èŠ‚ç‚¹æ­£å¸¸æ‰§è¡Œ send_email                                               â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Editï¼ˆç¼–è¾‘ï¼‰                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚   äººå·¥å†³ç­–: {                                                                       â”‚
â”‚       "type": "edit",                                                               â”‚
â”‚       "edited_action": {                                                            â”‚
â”‚           "name": "send_email",                                                     â”‚
â”‚           "args": {                                                                 â”‚
â”‚               "recipient": "boss@company.com",  # ä¿®æ”¹æ”¶ä»¶äºº                        â”‚
â”‚               "subject": "å‘¨æŠ¥ - ç¬¬42å‘¨",       # ä¿®æ”¹ä¸»é¢˜                          â”‚
â”‚               "body": "ä¿®æ”¹åçš„å†…å®¹..."         # ä¿®æ”¹æ­£æ–‡                          â”‚
â”‚           }                                                                         â”‚
â”‚       }                                                                             â”‚
â”‚   }                                                                                 â”‚
â”‚                                                                                     â”‚
â”‚   å¤„ç†ç»“æœ:                                                                         â”‚
â”‚   - revised_tool_calls = [send_email(recipient="boss@company.com", ...)]  # ä¿®æ”¹å â”‚
â”‚   - artificial_tool_messages = []  # æ—                                             â”‚
â”‚                                                                                     â”‚
â”‚   åç»­: tools èŠ‚ç‚¹ç”¨ä¿®æ”¹åçš„å‚æ•°æ‰§è¡Œ send_email                                     â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Rejectï¼ˆæ‹’ç»ï¼‰                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚   äººå·¥å†³ç­–: {                                                                       â”‚
â”‚       "type": "reject",                                                             â”‚
â”‚       "message": "é‚®ä»¶å†…å®¹ä¸å®Œæ•´ï¼Œè¯·é‡æ–°èµ·è‰"                                       â”‚
â”‚   }                                                                                 â”‚
â”‚                                                                                     â”‚
â”‚   å¤„ç†ç»“æœ:                                                                         â”‚
â”‚   - revised_tool_calls = [send_email(...)]  # ä¿ç•™ï¼ˆä½†ä¸ä¼šçœŸæ­£æ‰§è¡Œï¼‰               â”‚
â”‚   - artificial_tool_messages = [                                                    â”‚
â”‚       ToolMessage(                                                                  â”‚
â”‚           content="é‚®ä»¶å†…å®¹ä¸å®Œæ•´ï¼Œè¯·é‡æ–°èµ·è‰",                                     â”‚
â”‚           name="send_email",                                                        â”‚
â”‚           tool_call_id="call_1",                                                    â”‚
â”‚           status="error",  # æ ‡è®°ä¸ºé”™è¯¯                                             â”‚
â”‚       )                                                                             â”‚
â”‚   ]                                                                                 â”‚
â”‚                                                                                     â”‚
â”‚   åç»­:                                                                             â”‚
â”‚   - send_email ä¸ä¼šæ‰§è¡Œï¼ˆå› ä¸ºå·²æœ‰å¯¹åº”çš„ ToolMessageï¼‰                               â”‚
â”‚   - æ¨¡å‹ä¼šæ”¶åˆ°æ‹’ç»æ¶ˆæ¯ï¼Œå¯èƒ½é‡æ–°è§„åˆ’                                                â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ä¸ƒã€interrupt() æœºåˆ¶è¯¦è§£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                     â”‚
â”‚                           interrupt() å·¥ä½œåŸç†                                       â”‚
â”‚                                                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚   interrupt() æ˜¯ LangGraph æä¾›çš„ä¸­æ–­æœºåˆ¶ï¼š                                         â”‚
â”‚                                                                                     â”‚
â”‚   1. è°ƒç”¨ interrupt(HITLRequest)                                                    â”‚
â”‚      â”œâ”€ LangGraph æš‚åœå½“å‰æ‰§è¡Œ                                                      â”‚
â”‚      â”œâ”€ å°†å½“å‰çŠ¶æ€ä¿å­˜åˆ° checkpointer                                               â”‚
â”‚      â””â”€ è¿”å›ä¸­æ–­ä¿¡æ¯ç»™è°ƒç”¨æ–¹                                                        â”‚
â”‚                                                                                     â”‚
â”‚   2. è°ƒç”¨æ–¹æ”¶åˆ°ä¸­æ–­                                                                 â”‚
â”‚      â”œâ”€ result = agent.invoke(...)                                                  â”‚
â”‚      â”œâ”€ result["__interrupt__"] åŒ…å« HITLRequest                                    â”‚
â”‚      â””â”€ å±•ç¤ºç»™äººå·¥å®¡æ‰¹                                                              â”‚
â”‚                                                                                     â”‚
â”‚   3. äººå·¥åšå‡ºå†³ç­–å                                                                 â”‚
â”‚      â”œâ”€ å†æ¬¡è°ƒç”¨ agent.invoke(HITLResponse, config=same_config)                     â”‚
â”‚      â”œâ”€ LangGraph ä» checkpointer æ¢å¤çŠ¶æ€                                          â”‚
â”‚      â”œâ”€ å°† HITLResponse ä¼ é€’ç»™ interrupt() çš„è¿”å›å€¼                                 â”‚
â”‚      â””â”€ ç»§ç»­æ‰§è¡Œ after_model çš„åç»­ä»£ç                                              â”‚
â”‚                                                                                     â”‚
â”‚   å…³é”®ï¼šå¿…é¡»ä½¿ç”¨ç›¸åŒçš„ thread_id æ‰èƒ½æ¢å¤æ­£ç¡®çš„çŠ¶æ€                                 â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ—¶åºå›¾ï¼š

  è°ƒç”¨æ–¹                    Agent                     Checkpointer
    â”‚                        â”‚                            â”‚
    â”‚ invoke(messages)       â”‚                            â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                            â”‚
    â”‚                        â”‚                            â”‚
    â”‚                        â”‚ model è¿”å› tool_calls      â”‚
    â”‚                        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
    â”‚                        â”‚                            â”‚
    â”‚                        â”‚ after_model æ£€æµ‹åˆ°éœ€å®¡æ‰¹   â”‚
    â”‚                        â”‚                            â”‚
    â”‚                        â”‚ interrupt(HITLRequest)     â”‚
    â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ ä¿å­˜çŠ¶æ€
    â”‚                        â”‚                            â”‚
    â”‚  è¿”å› __interrupt__    â”‚                            â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                            â”‚
    â”‚                        â”‚                            â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
    â”‚  â•‘          äººå·¥å®¡æ‰¹ï¼ˆå¯èƒ½æ˜¯åˆ†é’Ÿã€å°æ—¶ã€å¤©ï¼‰       â•‘â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
    â”‚                        â”‚                            â”‚
    â”‚ invoke(HITLResponse)   â”‚                            â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                            â”‚
    â”‚                        â”‚                            â”‚
    â”‚                        â”‚ æ¢å¤çŠ¶æ€                   â”‚
    â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚                        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                        â”‚                            â”‚
    â”‚                        â”‚ interrupt() è¿”å› decisions â”‚
    â”‚                        â”‚                            â”‚
    â”‚                        â”‚ ç»§ç»­ after_model          â”‚
    â”‚                        â”‚ _process_decision()       â”‚
    â”‚                        â”‚                            â”‚
    â”‚                        â”‚ tools èŠ‚ç‚¹æ‰§è¡Œ            â”‚
    â”‚                        â”‚                            â”‚
    â”‚   æœ€ç»ˆç»“æœ             â”‚                            â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                            â”‚
    â”‚                        â”‚                            â”‚
```

---

### å…«ã€å®Œæ•´æ•°æ®æµæ€»ç»“

```
ç”¨æˆ·å‘é€æ¶ˆæ¯
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ model èŠ‚ç‚¹ï¼ˆLLM å†³å®šè°ƒç”¨å·¥å…·ï¼‰                                    â”‚
â”‚                                                                  â”‚
â”‚ è¿”å› AIMessage:                                                  â”‚
â”‚   tool_calls = [                                                 â”‚
â”‚       {name: "send_email", args: {...}},  # éœ€è¦å®¡æ‰¹             â”‚
â”‚       {name: "read_file", args: {...}},   # ä¸éœ€è¦å®¡æ‰¹           â”‚
â”‚   ]                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ after_model (HumanInTheLoopMiddleware)                           â”‚
â”‚                                                                  â”‚
â”‚ 1. éå† tool_callsï¼Œæ£€æŸ¥ interrupt_on é…ç½®                       â”‚
â”‚ 2. send_email åœ¨é…ç½®ä¸­ â†’ åŠ å…¥å¾…å®¡æ‰¹åˆ—è¡¨                          â”‚
â”‚ 3. read_file ä¸åœ¨é…ç½®ä¸­ â†’ è‡ªåŠ¨æ‰¹å‡†                               â”‚
â”‚ 4. æ„å»º HITLRequestï¼Œè°ƒç”¨ interrupt()                            â”‚
â”‚ 5. â•â•â•â•â•â•â•â•â•â• ç­‰å¾…äººå·¥å†³ç­– â•â•â•â•â•â•â•â•â•â•                            â”‚
â”‚ 6. æ”¶åˆ° decisionsï¼Œå¤„ç†æ¯ä¸ªå†³ç­–                                  â”‚
â”‚ 7. æ›´æ–° AIMessage.tool_calls                                     â”‚
â”‚ 8. å¦‚æœ‰æ‹’ç»ï¼Œæ·»åŠ  ToolMessage(status="error")                    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ tools èŠ‚ç‚¹                                                        â”‚
â”‚                                                                  â”‚
â”‚ - æ‰§è¡Œ revised_tool_calls ä¸­çš„å·¥å…·                               â”‚
â”‚ - è¢«æ‹’ç»çš„å·¥å…·å·²æœ‰å¯¹åº” ToolMessageï¼Œä¸ä¼šé‡å¤æ‰§è¡Œ                 â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
ç»§ç»­å¾ªç¯æˆ–ç»“æŸ
```

---

### ä¹ã€ä½¿ç”¨ç¤ºä¾‹

```python
from langchain.agents import create_agent
from langchain.agents.middleware import HumanInTheLoopMiddleware
from langgraph.checkpoint.memory import InMemorySaver
from langchain_core.messages import HumanMessage

# åˆ›å»º Agent
agent = create_agent(
    model="gpt-4o",
    tools=[send_email_tool, read_email_tool, delete_email_tool],
    checkpointer=InMemorySaver(),  # å¿…é¡»é…ç½®
    middleware=[
        HumanInTheLoopMiddleware(
            interrupt_on={
                "send_email_tool": {
                    "allowed_decisions": ["approve", "edit", "reject"],
                    "description": "å‘é€é‚®ä»¶éœ€è¦å®¡æ‰¹",
                },
                "delete_email_tool": True,  # åˆ é™¤é‚®ä»¶éœ€è¦å®¡æ‰¹ï¼Œå…è®¸æ‰€æœ‰å†³ç­–
                "read_email_tool": False,   # è¯»å–é‚®ä»¶ä¸éœ€è¦å®¡æ‰¹
            },
        ),
    ],
)

# é…ç½®ï¼ˆå¿…é¡»åŒ…å« thread_id ä»¥æ”¯æŒæ¢å¤ï¼‰
config = {"configurable": {"thread_id": "user-123-session-456"}}

# ç¬¬ä¸€æ¬¡è°ƒç”¨
result = agent.invoke(
    {"messages": [HumanMessage("å‘é€é‚®ä»¶ç»™è€æ¿ï¼Œä¸»é¢˜æ˜¯å‘¨æŠ¥")]},
    config=config,
)

# æ£€æŸ¥æ˜¯å¦è¢«ä¸­æ–­
if "__interrupt__" in result:
    hitl_request = result["__interrupt__"]
    print("ç­‰å¾…äººå·¥å®¡æ‰¹...")
    for action in hitl_request["action_requests"]:
        print(f"  å·¥å…·: {action['name']}")
        print(f"  å‚æ•°: {action['args']}")
        print(f"  è¯´æ˜: {action['description']}")
    
    # æ¨¡æ‹Ÿäººå·¥å®¡æ‰¹ - æ‰¹å‡†
    response = agent.invoke(
        {"decisions": [{"type": "approve"}]},
        config=config,  # å¿…é¡»ä½¿ç”¨ç›¸åŒçš„ config
    )
    
    # æˆ–è€… - ç¼–è¾‘
    response = agent.invoke(
        {
            "decisions": [{
                "type": "edit",
                "edited_action": {
                    "name": "send_email_tool",
                    "args": {
                        "recipient": "boss@company.com",
                        "subject": "å‘¨æŠ¥ - ä¿®æ”¹ç‰ˆ",
                        "body": "æ–°å†…å®¹...",
                    },
                },
            }]
        },
        config=config,
    )
    
    # æˆ–è€… - æ‹’ç»
    response = agent.invoke(
        {
            "decisions": [{
                "type": "reject",
                "message": "é‚®ä»¶å†…å®¹éœ€è¦è¡¥å……è¯¦ç»†æ•°æ®",
            }]
        },
        config=config,
    )
```

---

### åã€å…³é”®è®¾è®¡æ€»ç»“

| ç»„ä»¶ | ä½œç”¨ |
|------|------|
| `checkpointer` | **å¿…é¡»é…ç½®**ï¼Œç”¨äºä¿å­˜ä¸­æ–­æ—¶çš„çŠ¶æ€ |
| `interrupt_on` | é…ç½®å“ªäº›å·¥å…·éœ€è¦äººå·¥å‚ä¸ |
| `interrupt()` | LangGraph æä¾›çš„ä¸­æ–­å‡½æ•°ï¼Œæš‚åœæ‰§è¡Œå¹¶ä¿å­˜çŠ¶æ€ |
| `HITLRequest` | å‘é€ç»™äººå·¥çš„å®¡æ‰¹è¯·æ±‚ï¼ŒåŒ…å«åŠ¨ä½œå’Œé…ç½® |
| `HITLResponse` | äººå·¥è¿”å›çš„å†³ç­–åˆ—è¡¨ |
| `after_model` | é’©å­æ—¶æœºï¼šæ¨¡å‹è¿”å›åï¼Œå·¥å…·æ‰§è¡Œå‰ |
| `Decision` | ä¸‰ç§å†³ç­–ç±»å‹ï¼šapproveã€editã€reject |
| `thread_id` | æ ‡è¯†ä¼šè¯ï¼Œç”¨äºæ¢å¤æ­£ç¡®çš„ä¸­æ–­çŠ¶æ€ |
| `artificial_tool_messages` | reject æ—¶æ³¨å…¥çš„é”™è¯¯ ToolMessage |

